<%- include("../../views/partials/admin/header") %>

    <body>
        <section class="content-main">
            <div class="content-header row shadow-sm">
                <header class="card-header d-flex  justify-content-between">
                    <h2 class="content-title card-title">Orders</h2>
                    <form action="/admin/users/" method="get" class="col-lg-5 me-5">
                        <!-- <div class="input-group input-group-sm border border-2 shadow rounded-pill "> <input type="text"
                                class="form-control border-0 rounded-pill bg-transparent" placeholder=" Search Users..."
                                name="search">
                            <button class="btn border border-2 border-end-0 border-top-0 border-bottom-0"
                                type="submit">Search</button> -->
            </div>
            </form>
            </header>
            </div>
            </div>

            <div class="right mt-5 mx-5 card p-3 shadow col-sm col-md col-lg ">
                <table class="table table-striped border border-2 table-hover table-light ">
                    <thead>
                        <% if(orders.length==0){ %>
                            <h1 class="text-center">No orders found</h1>
                            <% } else{%>
                                <tr>
                                    <th>Order ID</th>
                                    <th>Date of Order</th>
                                    <th>user name</th>
                                    <th>Status</th>
                                    <th>Payment Method</th>
                                    <th>Action</th>
                                </tr>
                    </thead>
                    <tbody>
                        <% orders.forEach(order=> { %>
                            <tr>
                                <td>
                                    <%= order.orderId.slice(0,18) %>
                                </td>
                                <td>
                                    <%= new Date(order.createdAt).toLocaleDateString() %>
                                </td>
                                <td>
                                    <%= order.userId.name %>
                                </td>
                                <td>
                                    <%= order.orderStatus %>
                                </td>
                                <td>
                                    <%= order.paymentMethod %>
                                </td>
                                <td>
                                    <select class="form-select"
                                        onchange="updateOrderStatus('<%= order._id %>', this.value)">
                                        <option value="Processing" <%=order.orderStatus==='Processing' ? 'selected' : ''
                                            %>>Processing</option>
                                        <option value="Shipped" <%=order.orderStatus==='Shipped' ? 'selected' : '' %>
                                            >Shipped</option>
                                        <option value="Delivered" <%=order.orderStatus==='Delivered' ? 'selected' : ''
                                            %>>Delivered</option>
                                        <option value="Cancelled" <%=order.orderStatus==='Cancelled' ? 'selected' : ''
                                            %>>Cancelled</option>
                                        <option value="Return Request" <%=order.orderStatus==='Return Request'
                                            ? 'selected' : '' %>>Return Request</option>
                                        <option value="Returned" <%=order.orderStatus==='Returned' ? 'selected' : '' %>
                                            >Returned</option>
                                    </select>
                                </td>
                            </tr>
                            <% }); %>
                                <% } %>

                    </tbody>
                </table>
            </div>

            <!-- <div class="container ">
                <nav aria-label="Page navigation">
                    <ul class="pagination justify-content-center mb-20">
                        for(let i=1;i<=totalPages;i++){ %>
                            <li class="page-item (i===currentPage) ? 'active' : '' %>">
                                <a class="page-link" href="?page=   i %>">
                                    i %>
                                </a>
                            </li>
                             } %>
                    </ul>
                </nav>
            </div> -->



            <script>
                function updateOrderStatus(orderId, newStatus) {
                    if (confirm('Are you sure you want to change the status of this order?')) {
                        axios.post('/updateOrderStatus', { orderId, newStatus })
                            .then(response => {
                                if (response.data.success) {
                                    Swal.fire('Success', 'Order status updated successfully', 'success');
                                } else {
                                    Swal.fire('Error', response.data.message, 'error');
                                }
                            })
                            .catch(error => {
                                Swal.fire('Error', 'Failed to update order status', 'error');
                                console.error('Error updating order status:', error);
                            });
                    }
                }

                function viewOrderDetails(orderId) {
                    window.location.href = `/orderDetails/${orderId}`;
                }
            </script>





            <%- include("../../views/partials/admin/footer") %>